================================================================================
  🔴 CRÍTICO - 5 Novos Erros SystemError (Segunda Execução)
================================================================================

DATA: 29 de outubro de 2025 | HORA: 10:49 UTC
STATUS: 🔴 PADRÃO SISTEMÁTICO (Não é pontual!)

================================================================================
  📊 COMPARAÇÃO: Primeira vs Segunda Execução
================================================================================

PRIMEIRA EXECUÇÃO (10:37-10:38):
  Erros:        4 SystemError
  Batches:      6, 13
  Taxa:         0,02%
  
SEGUNDA EXECUÇÃO (10:49):
  Erros:        5 SystemError ← NOVOS!
  Batches:      2, 3
  Taxa:         ~0,025%+ (aumentando!)
  
PARALELO:       +200 erros "Cannot insert value NUL"

CONCLUSÃO:      🔴 PROBLEMA SISTEMÁTICO, não pontual!

================================================================================
  🚨 RECOMENDAÇÕES IMEDIATAS
================================================================================

PRIORIDADE 1 (AGORA - 15 min):
  ☐ Parar agendador automático
  ☐ Aumentar timeouts em .env:
    → DB_CONNECTION_TIMEOUT: 30 → 180
    → TIMEOUT_DOWNLOAD: 60 → 180
    → POST_RETRIES: 3 → 10
    → BACKOFF_BASE: 1.5 → 3.0
  ☐ Verificar versão driver ODBC
  ☐ Testar conexão manual

PRIORIDADE 2 (Próxima 30 min):
  ☐ Ativar SQL Profiler para capturar erro real
  ☐ Executar com debug (SINGLE_RUN=true)
  ☐ Monitorar resultado

PRIORIDADE 3 (Se não resolver):
  ☐ Escalar para DBA/Infraestrutura URGENTEMENTE
  ☐ Enviar logs completos
  ☐ Solicitar análise de driver/conexão

================================================================================
  📋 Ações do Seu Lado (Imediato)
================================================================================

PASSO 1: Abrir .env
  ┌─────────────────────────────────────────────────────────┐
  │ Procurar por:                                           │
  │ • DB_CONNECTION_TIMEOUT=30                              │
  │ • TIMEOUT_DOWNLOAD=60                                   │
  │ • POST_RETRIES=3                                        │
  │ • BACKOFF_BASE=1.5                                      │
  └─────────────────────────────────────────────────────────┘

PASSO 2: Executar PowerShell (COPIAR/COLAR):

$file = '.env'
$content = Get-Content $file
$content = $content -replace 'DB_CONNECTION_TIMEOUT=.*', 'DB_CONNECTION_TIMEOUT=180'
$content = $content -replace 'TIMEOUT_DOWNLOAD=.*', 'TIMEOUT_DOWNLOAD=180'
$content = $content -replace 'POST_RETRIES=.*', 'POST_RETRIES=10'
$content = $content -replace 'BACKOFF_BASE=.*', 'BACKOFF_BASE=3.0'
Set-Content $file $content
Write-Host "✅ Configurações atualizadas para URGÊNCIA!" -ForegroundColor Green

PASSO 3: Verificar mudanças:

Select-String "CONNECTION_TIMEOUT|TIMEOUT_DOWNLOAD|RETRIES|BACKOFF" .env

  Saída esperada:
  ✅ DB_CONNECTION_TIMEOUT=180
  ✅ TIMEOUT_DOWNLOAD=180
  ✅ POST_RETRIES=10
  ✅ BACKOFF_BASE=3.0

PASSO 4: Testar conexão:

python tests/test_sql_connection.py

  Esperado: ✅ Conectado com sucesso!

PASSO 5: Executar uma única vez:

set DEBUG_MODE=true
set SINGLE_RUN=true
python app.py

  Observar:
  • Desaparecem SystemError?
  • Reduzem erros "Cannot insert NUL"?
  • Tempo de execução?

================================================================================
  📊 Análise Rápida dos 5 Erros
================================================================================

ERRO #1 - Batch 2, Registro 221 (Linha 1222)
  ├─ Hora: 10:49:47
  ├─ Grupo: Fixa Básica - BL Renovação
  ├─ Produto: BANDA LARGA 700 Mbps 1P
  └─ Status: ❌ SystemError (pyodbc.Error)

ERRO #2 - Batch 2, Registro 718 (Linha 1719)
  ├─ Hora: 10:49:51
  ├─ Grupo: Móvel - Migração PP
  ├─ Produto: SMART EMPRESAS 6GB (Qtd: 10)
  └─ Status: ❌ SystemError (pyodbc.Error)

ERRO #3 - Batch 3, Registro 209 (Linha 2210)
  ├─ Hora: 10:49:54
  ├─ Grupo: Movel Altas - Portabilidade
  ├─ Produto: SMART EMPRESAS 6GB
  └─ Status: ❌ SystemError (pyodbc.Error)

ERRO #4 - Batch 3, Registro 238 (Linha 2239)
  ├─ Hora: 10:49:55
  ├─ Grupo: Móvel Altas - Totais
  ├─ Produto: SMART EMPRESAS 15GB
  └─ Status: ❌ SystemError (pyodbc.Error)

ERRO #5 - Batch 3, Registro 432 (Linha 2433)
  ├─ Hora: 10:49:56
  ├─ Grupo: Móvel Altas - Totais
  ├─ Produto: SMART EMPRESAS 15GB
  └─ Status: ❌ SystemError (pyodbc.Error)

PADRÃO: 5 erros em batches diferentes (2 e 3)
        Batches mudam a cada execução
        → Problema de conexão/driver, não dados

================================================================================
  🎯 O Que Fazer AGORA
================================================================================

NÃO FAZER:
  ❌ Esperar problema passar
  ❌ Ignorar padrão sistemático
  ❌ Deixar agendador gerando mais erros
  ❌ Aumentar ainda mais timeouts sem limite

SIM FAZER:
  ✅ Parar agendador
  ✅ Aumentar timeouts (conforme plano)
  ✅ Testar com debug
  ✅ Se não resolver em 30 min → Escalar

================================================================================
  📞 Se Não Conseguir Resolver em 30 Minutos
================================================================================

ESCALAR PARA:
  Equipe de Infraestrutura / DBA

INFORMAÇÕES A ENVIAR:
  • Timestamp dos erros: 10:37-10:38 + 10:49
  • Arquivo: error_records_producao.jsonl
  • Log: robo_download.log (últimas 100 linhas)
  • Versão ODBC: [resultado do comando acima]
  • Ação tomada: Aumentar timeouts para 180s

MENSAGEM-CHAVE:
  "Erro SystemError repetindo em diferentes batches.
   Padrão sistemático, não pontual. Possível problema
   com driver ODBC ou pool de conexões SQL Server."

================================================================================
  📈 Sinais de Sucesso vs Falha
================================================================================

✅ SUCESSO:
   • SystemError desaparece
   • Taxa de erro volta para 0,00%
   • Execução rápida (<5 min)
   • Nenhum novo erro em 3 execuções

❌ FALHA:
   • SystemError continua
   • Diferentes batches a cada vez
   • Mesmo com timeouts 180s
   • Driver ODBC versão antiga

Se FALHA → Escalar URGENTEMENTE

================================================================================
  ⏰ Timeline Recomendado
================================================================================

10:51 - 11:06 (AGORA - 15 min):
  Aplicar mudanças em .env
  
11:06 - 11:16 (Próximos 10 min):
  Testar conexão + debug
  
11:16 - 11:26 (Próximos 10 min):
  Monitorar resultado
  
11:26 - ? (Decisão):
  ✅ Resolveu? → Volta para production
  ❌ Não resolveu? → Escalar para DBA

================================================================================

Documentos de referência:
  • docs/ANALISE_5_NOVOS_ERROS_SYSTEMOERROR.md (análise completa)
  • docs/ACAO_URGENTE_5_ERROS_SYSTEMOERROR.md (guia detalhado)
  • docs/CONFIGURACOES_ANTES_DEPOIS.md (explicação de mudanças)

Status: 🔴 CRÍTICO - Ação IMEDIATA necessária
Próxima revisão: Após aplicar mudanças em .env (em ~10 min)

================================================================================
